@startuml

abstract class Consensus {
  {abstract} +takeConsensus(data)
  {abstract} +receiveData(data) : void
}

class ImageLabelConsensus {
  +takeConsensus(data)
  +receiveData(data) : void
}

class PipelineRequest {
  -requestID : Uint
  -datasetSource : String
  -modelSource : String
  -provider : Address
  -bid : Uint
  -consensusMethod : Consensus
  -result : Container
  -participation : Map<Worker, float>
}

class Worker {
  -WorkerAddress : String
  -currentlyWorking : Bool
  -currentRequest : Request
  -currentDeposit : Uint
  +takeDeposit(amount : Uint)
  +returnDeposit() : void
}

class Pipeline {
  -waitingRequests : PriorityQueue<PipelineRequest>
  -workingRequests : PipelineRequest[]
  -Workers : Worker[]
  +retrieveRequests() : Request[]
  +finishRequest(request : Request)
}

class User {
  -Address : String
}

class Client {
  -Worker : User
  -requestID: Uint
  +getModel(request : Request)
  +getDataSet(request : Request)
  +startMining(user : User)
}

class TokenManager {
  -dividends : Map<Uint, Uint>
  -token : POVToken
  -router : Address
  -requests : Map<Uint, Request>
  -waitingIDs : EnumerableSet.UintSet
  -workingIDs : EnumerableSet.UintSet
  -nextRequestID : Uint
  -nextTokenID : Uint
  +createRequest(datasetSource : String, modelSource : String, numImages : Uint) public payable returns(Uint)
  +sendAllRequests() public
  +distributeDividends(val : Uint) internal
  +claimDividends() public nonReentrant
  +retrieveData(requestID : Uint, _results : String, _participants : Address[]) public pipelineOnly returns(Uint)
  +getResults(requestID : Uint) public view returns(String)
  +<<Modifier>> nonReentrant
  +<<Modifier>> pipelineOnly
  +<<Event>> tokenPaid(tokenID : Uint, paidTo : Address)
  +<<Event>> dividendsPaid(amountPerToken : Uint)
  +<<Event>> dividendsClaimed(amount : Uint, paidTo : Address)
}

class Request {
  -requestID : Uint
  -datasetSource : String
  -modelSource : String
  -requestOwner : Address
  -bid : Uint
  -numImages : Uint
  -consensusType : String
  -results : String
  -participants : EnumerableSet.AddressSet
}

class ERC1155 {
}

class Ownable {
}

class POVToken {
  +setOwner(owner : Address) public onlyOwner
  +setURI(newuri : String) public onlyOwner
  +mint(add : Address, id : Uint, amount : Uint, data : Bytes) public returns(Uint)
}

TokenManager "1" -- "many" Request : contains
TokenManager -- POVToken : owns
POVToken --|> ERC1155 : is
POVToken --|> Ownable : is
Consensus <|-- ImageLabelConsensus
PipelineRequest "1" *-- "1" Consensus : uses
Worker "1" -- "1" PipelineRequest : working on
Pipeline "1" -- "many" PipelineRequest : manages
Pipeline "1" -- "many" Worker : manages
Client -down-> User : has

@enduml
